# GalaSwap SDK Wrapper Cleanup Plan

## Executive Summary
Remove 860 lines of custom wrapper code and migrate to native SDK with baseUrl override, which has been proven to work perfectly in production.

## Current State Analysis

### The Wrapper Problem
- **860 lines** of custom wrapper code in `src/services/gswap-wrapper.ts`
- 4 service classes overriding SDK methods (FixedQuotingService, FixedTradingService, FixedPoolsService, FixedSwapsService)
- 44 total files importing from the wrapper (29 in src/, 15 debug/root scripts)
- Complex endpoint routing logic that's no longer needed

### The Simple Solution
Native SDK with baseUrl override works perfectly:
```typescript
const gSwap = new GSwap({
  signer: new PrivateKeySigner(privateKey),
  baseUrl: 'https://dex-backend-prod1.defi.gala.com'
});
```

## File Impact Analysis

### Core Production Files (Priority 1)
1. `src/trading/TradingEngine.ts` - Main trading orchestrator
2. `src/trading/execution/swap-executor.ts` - Trade execution
3. `src/trading/strategies/arbitrage.ts` - Arbitrage strategy
4. `src/trading/risk/risk-monitor.ts` - Risk management
5. `src/trading/risk/emergency-controls.ts` - Emergency controls
6. `src/trading/risk/position-limits.ts` - Position limits
7. `src/monitoring/position-tracker.ts` - Position tracking
8. `src/monitoring/market-analysis.ts` - Market analysis
9. `src/services/liquidity-manager.ts` - Liquidity management

### Performance Files (Priority 2)
10. `src/performance/OptimizedTradingEngine.ts` - Optimized engine
11. `src/performance/OptimizedRiskMonitor.ts` - Optimized risk
12. `src/trading/recovery/arbitrage-recovery.ts` - Recovery logic

### Test Files (Priority 3)
- 3 liquidity manager tests
- 1 test helper file
- 9 script files for testing various components

### Debug Scripts (To be deleted)
- 15 debug scripts in root directory (test-*.ts, debug-*.ts, execute-*.ts, check-*.ts)
- These were created during wrapper development and are no longer needed

## Migration Strategy

### Phase 1: Update Core Trading Engine
1. Modify `TradingEngine.ts` constructor:
   ```typescript
   // BEFORE
   this.gswap = new GSwap({
     signer: new PrivateKeySigner(config.wallet.privateKey),
     walletAddress: config.wallet.address,
     gatewayBaseUrl: config.api.baseUrl,
     dexBackendBaseUrl: config.api.baseUrl,
     bundlerBaseUrl: config.api.bundlerUrl
   });

   // AFTER
   import { GSwap, PrivateKeySigner } from '@gala-chain/gswap-sdk';

   this.gswap = new GSwap({
     signer: new PrivateKeySigner(config.wallet.privateKey),
     baseUrl: config.api.baseUrl
   });
   ```

### Phase 2: Update All Imports
Replace in all 29 src/ files:
```typescript
// BEFORE
import { GSwap, PrivateKeySigner } from '../services/gswap-wrapper';

// AFTER
import { GSwap, PrivateKeySigner } from '@gala-chain/gswap-sdk';
```

### Phase 3: Verify API Methods
The SDK methods are already compatible:
- `gSwap.quoting.quoteExactInput()` ✅
- `gSwap.swaps.swap()` ✅
- `gSwap.pools.getPoolData()` ✅
- `gSwap.pools.calculateSpotPrice()` ✅

### Phase 4: Cleanup
1. Delete wrapper file: `src/services/gswap-wrapper.ts`
2. Delete all debug scripts in root (15 files)
3. Update any type imports if needed

## Implementation Steps

### Step 1: Create Branch
```bash
git checkout -b cleanup/remove-gswap-wrapper
```

### Step 2: Update TradingEngine.ts
- Change import statement
- Simplify constructor to use baseUrl
- Remove unnecessary URL parameters

### Step 3: Batch Update Imports
Use TypeScript Language Server to update all imports:
- Find all references to gswap-wrapper
- Update each to use @gala-chain/gswap-sdk

### Step 4: Run Tests
```bash
npm test
npm run test:integration
```

### Step 5: Test Production Trade
```bash
npm run test:production
```

### Step 6: Delete Wrapper and Debug Files
```bash
rm src/services/gswap-wrapper.ts
rm test-*.ts debug-*.ts execute-*.ts check-*.ts
```

### Step 7: Final Verification
- Run full test suite
- Execute small production trade
- Check all imports are clean

## Benefits

1. **Code Reduction**: -860 lines of complex wrapper code
2. **Maintainability**: Direct SDK usage = easier upgrades
3. **Reliability**: SDK bugs fixed by Gala team
4. **Simplicity**: No custom endpoint routing
5. **Performance**: One less abstraction layer

## Risk Mitigation

1. **Git History**: Wrapper code preserved in git history
2. **Gradual Migration**: Test each component after update
3. **Test Coverage**: 123 existing tests validate behavior
4. **Small Production Test**: Execute minimal trade before full deployment
5. **Rollback Plan**: Git revert if issues arise

## Success Criteria

- ✅ All tests pass (123 tests)
- ✅ Production trade executes successfully
- ✅ No wrapper code remaining
- ✅ All imports use native SDK
- ✅ Debug scripts removed

## Time Estimate

- **Total Time**: 2-3 hours
- Phase 1 (Core Update): 30 minutes
- Phase 2 (Import Updates): 45 minutes
- Phase 3 (Testing): 45 minutes
- Phase 4 (Cleanup): 30 minutes

## Notes

The baseUrl override discovery is a game-changer. The SDK actually supports this parameter but it wasn't documented. This means we can use the native SDK directly without any wrapper, making the codebase much simpler and more maintainable.